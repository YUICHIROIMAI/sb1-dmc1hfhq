# ミルダス

「ミルダス」は、SNSマーケティング担当者向けに、各SNS（TikTok、Instagram、YouTube）のデータ取得・分析、台本生成、投稿予約、レポート出力、さらに競合分析などをワンストップで提供するツールです。本プロジェクトは、AWS を使用せず、Bolt.new によるデザイン自動生成と Netlify をバックエンドプラットフォームとして開発されます。また、ユーザー認証、プラン制限（ミニマム、スタンダード、プレミアム）に加え、管理者専用機能も実装予定です。

---

## 1. はじめに

「ミルダス」は、SNSマーケティング担当者が以下の業務をサポートできるツールです。

- **月次レポート作成**  
  SNS各媒体のパフォーマンス指標（インプレッション、リーチ、エンゲージメントなど）の集計およびグラフ表示

- **投稿予約**  
  ExcelライクなカレンダーUIでの予約登録・変更管理

- **台本生成**  
  ChatGPT API を利用し、日本語タイトルから自動的に台本を生成

- **競合分析**  
  指定期間内のデータを抽出し、一覧表示で競合アカウントの投稿やエンゲージメントデータを確認

- **分析ダッシュボード・レポート出力**  
  指定期間・指標に基づく集計結果をグラフやテーブルで可視化し、Excel/CSV/PDF 形式でレポート出力

- **管理者機能**  
  管理画面上でユーザーの追加、削除、変更、さらにプロンプトの変更や修正が可能

---

## 2. システム概要

- **対象ユーザー:**  
  SNSマーケティング担当者および管理者

- **利用シーン:**  
  - SNSパフォーマンスの月次集計とレポート作成  
  - 日常的な投稿予約の管理  
  - タイトル入力による台本生成  
  - 競合分析で期間指定により競合アカウントのデータを一覧表示  
  - 管理者がシステム内のユーザー情報およびプロンプトの管理を実施

- **提供機能:**  
  1. ユーザー認証・アカウント管理  
  2. SNS API連携とデータ取得  
  3. 台本作成機能（生成AI連携）  
  4. 投稿予約機能  
  5. 分析ダッシュボード・レポート出力  
  6. 競合分析機能  
  7. 管理者機能（ユーザー管理・プロンプト管理）

---

## 3. 各機能の詳細仕様

### 3.1 ユーザー認証・アカウント管理

- **登録情報:**
  - **ID:** メールアドレス形式 (例: `user@company.com`)
  - **パスワード:** セキュアにハッシュ化 (例: BCrypt)
  - **会社名:** ユーザーの所属企業
  - **プラン:**  
    - **ミニマムプラン:** 調査機能＋分析レポート出力のみ  
    - **スタンダードプラン:** ミニマム機能＋投稿予約機能  
    - **プレミアムプラン:** スタンダード機能＋台本生成機能
- **認証実装:**
  - フロントエンドは Netlify 上でホスト
  - **Netlify Identity** を利用し、認証・ログイン管理を実施
  - ユーザー情報は **Supabase** 内のユーザーテーブルに保存
- **管理者機能:**
  - 管理者は管理画面上でユーザーの追加、削除、変更が可能
  - 管理者はシステム内のすべてのユーザー情報およびSNSデータにアクセス可能
  - また、管理者はプロンプトテンプレートの変更や修正ができる
  - アクセス権限は RBAC（ロールベースアクセス制御）で管理

---

### 3.2 SNS API連携とデータ取得

- **対象SNSと取得項目:**
  - **TikTok:** 投稿時間、再生回数、コメント数、いいね数
  - **Instagram:** 投稿タイプ（画像、動画、リール等）、投稿時間、コメント数、いいね数
  - **YouTube:** 投稿時間、再生回数、コメント数、いいね数
- **連携方法:**
  - 各SNSの公式 API を利用し、Netlify Functions 内で定期実行のデータ取得処理を実装
  - APIキーや認証情報は Supabase または Netlify の環境変数で管理
- **データ取得頻度:**
  - 可能な限りリアルタイムに近い更新を目指すが、システム負荷に応じて半日1回の更新も検討

---

### 3.3 台本作成機能（生成AI連携）

#### 3.3.1 基本フロー

1. **ユーザー入力:**
   - ユーザーが台本生成画面で日本語タイトル（例: 「新製品の紹介」）を入力し、Netlify Functions を通じてバックエンドへ送信
2. **プロンプト組み立て:**
   - 事前に用意した固定プロンプトテンプレート
     ```
     「以下のタイトルに基づいて、魅力的な台本を生成してください：{タイトル}」
     ```
     を使用
   - 将来的には Supabase の「prompt_templates」テーブルからユーザーやプランに応じたカスタマイズ可能なプロンプトを動的に取得する設計に拡張
   - ユーザー入力をテンプレートに埋め込み、最終的な API リクエスト用のプロンプトを作成
3. **ChatGPT API 呼び出し:**
   - Netlify Functions 内で組み立てたプロンプトを元に OpenAI の ChatGPT API にリクエスト
   - タイムアウト、レート制限、エラーレスポンスの解析など、適切なエラーハンドリングを実装
4. **生成結果の返却と加工:**
   - API から取得した生成結果を整形（改行、段落分割等）し、JSON形式でフロントエンドに返却
   - フロントエンド上では、結果がテキストエリアに表示され、ユーザーが編集可能

#### 3.3.2 実装の具体例

- **プロンプトテンプレート管理:**
  - 初期は固定値をハードコードまたは環境変数に設定
  - 将来的には Supabase の「prompt_templates」テーブルで、ユーザーごとのカスタマイズが可能に
- **APIリクエスト処理:**
  - Netlify Functions で「リクエスト受信 → プロンプト組み立て → ChatGPT API 呼び出し → 結果返却」の一連の流れを実装
- **エラーハンドリングとロギング:**
  - API 失敗時は Netlify のログに記録し、ユーザーへエラーメッセージを返す

---

### 3.4 投稿予約機能

#### 3.4.1 基本フロー

1. **予約情報の受信:**
   - フロントエンドの Excel ライクなカレンダー UI で、ユーザーが予約投稿（予約日時、投稿内容、対象SNS等）を入力し、Netlify Functions へ送信
2. **データ保存と管理:**
   - バックエンドは Supabase 内に「post_reservations」テーブルを作成し、以下の情報を保存
     - **カラム例:** `reservation_id`, `user_id`, `sns_type`, `post_content`, `scheduled_time`, `status`（予約済み、実行済み、エラー）、`error_message`
3. **スケジューリング:**
   - Netlify Functions と Cron Job 仕組み（もしくは外部ジョブスケジューラ）を利用して定期的に「post_reservations」テーブルをチェック
   - 予約時刻が近づいた投稿予約に対して、対象SNSの API へ投稿リクエストを送信
4. **投稿実行とエラーハンドリング:**
   - SNS API（TikTok、Instagram、YouTube）のエンドポイントに対して POST リクエストを実施
   - 成功時は、対象予約の状態を「実行済み」に更新
   - 失敗時は、エラーメッセージをテーブルに記録し、ユーザーへメールまたはアプリ内通知でアラートを送信

#### 3.4.2 実装の具体例

- **予約情報保存:**
  - Supabase の PostgreSQL に「post_reservations」テーブルを作成
- **ジョブスケジューリング:**
  - Netlify Functions と Cron Job プラグイン（または外部サービス）を利用して、定期的に「post_reservations」テーブルをチェック
  - 予約時刻に合わせ、SNS API へ投稿リクエストを実施
- **SNS API連携:**
  - 各SNSの API 仕様に基づき、環境変数や Supabase に保存された認証情報を使用して POST リクエストを実施
- **エラーハンドリング:**
  - 投稿失敗時、エラーメッセージを DB に記録し、管理者およびユーザー通知用のエンドポイントで対応

---

### 3.5 分析ダッシュボード・レポート出力

#### 3.5.1 基本フロー

1. **データ取得と集計:**
   - バックエンドは Supabase に保存された各SNSデータをもとに、ユーザーが指定する期間（開始日・終了日）や各投稿ごとの指標を集計する
2. **可視化用データ生成:**
   - アカウント全体の指標（例：インプレッション数、リーチ数、プロフィール閲覧数、リンククリック数、フォロワー数、投稿数、総合評価指標）を、折れ線グラフや棒グラフ用の JSON 形式に変換する
   - 各投稿の詳細データ（インプレッション、リーチ、コメント数、いいね数、視聴維持率、エンゲージメント率）を、Excel ライクなテーブル形式に整形する
3. **レポート出力:**
   - ユーザーは出力形式（Excel、CSV、PDF）を選択可能。指定条件に基づいてレポートファイルを生成する
   - 生成されたレポートファイルは、Netlify Functions 内でファイル生成ライブラリを使用して一時ストレージに保存し、ダウンロードリンクを返却する

#### 3.5.2 実装の具体例

- **データ集計:**
  - Netlify Functions を利用して、Supabase から各SNSデータを取得し、必要な統計値を計算する
  - 集計処理はサーバーレス関数または定期ジョブで実施
- **可視化用フォーマット生成:**
  - 折れ線グラフ・棒グラフ用の JSON データおよび、並べ替え・フィルタリング可能なテーブルデータを整形してフロントエンドへ返却
- **レポート出力:**
  - Excel、CSV、PDF の出力には、各種ライブラリ（例: xlsx、csv-writer、PDFKit 等）を利用
  - 出力ファイルは、一時ストレージに保存後、ダウンロードリンクを返却

#### 3.5.3 ユーザー操作と連携イメージ

- **ユーザー操作:**
  - ユーザーはダッシュボード画面で、開始日・終了日、SNS、表示指標を選択し、集計結果を折れ線グラフや棒グラフ、Excelライクなテーブルで確認する
  - さらに、レポート出力機能から希望するファイル形式（Excel、CSV、PDF）を選択してレポートをダウンロードできる
- **連携:**
  - バックエンドが集計済みデータを JSON 形式で返却し、出力リクエスト時に条件に基づいたレポートファイルを生成してダウンロードリンクを提供

---

### 3.6 競合分析機能

#### 3.6.1 基本フロー

1. **期間指定:**
   - ユーザーは競合分析画面で、開始日と終了日を指定する
2. **データ抽出:**
   - バックエンドは、指定期間内の各SNSから取得済みの競合アカウントデータを Supabase から抽出する
3. **一覧表示:**
   - 抽出したデータを、投稿の種類、投稿時間、エンゲージメント（コメント、いいね数など）などの項目で一覧表示する
4. **フィルタ・ソート機能:**
   - ユーザーが一覧内で、投稿タイプやエンゲージメント数などを基準にフィルタやソートを実施できるようにする

#### 3.6.2 実装の具体例

- **データ抽出・集計:**
  - Netlify Functions を利用して、Supabase 内の SNSデータから指定期間の競合分析用データを取得
  - 集計処理によって、ユーザーが必要とする指標（投稿種類、投稿時間、エンゲージメント数）を整形
- **一覧表示:**
  - フロントエンド上で、取得した JSON データを基に Excel ライクなテーブル形式で一覧表示し、フィルタ・ソート機能を実装
- **連携:**
  - 競合分析画面の操作に合わせて、バックエンドとフロントエンドでデータのやり取りを行う

---

## 4. バックエンド・インフラ構成（Netlify/Bolt.new版）

### 4.1 実装環境

- **ホスティング:**
  - **Netlify** をバックエンドプラットフォームとして利用
  - **Netlify Functions** を用いたサーバーレス処理を実装
- **データベース:**
  - **Supabase (PostgreSQL)** を利用し、ユーザー情報、SNS認証情報、取得データ、予約情報、プロンプトテンプレート、集計結果などを管理

### 4.2 セキュリティ対策

- **認証情報管理:**
  - SNS API キーやユーザーパスワード等は、SupabaseおよびNetlifyの環境変数でセキュアに管理
  - **Netlify Identity** と **Supabase Auth** を連携して、ユーザー認証・権限管理を実施
- **アクセス管理:**
  - RBAC（ロールベースアクセス制御）を実装し、管理者と一般ユーザーの権限を明確に分離
- **ネットワーク:**
  - Netlify のセキュリティ機能と、外部脆弱性診断ツールを用いて定期的な監視・チェックを実施

### 4.3 スケジューリング、ロギング、モニタリング

- **スケジューリング:**
  - Netlify Functions と Cron Job プラグイン、または外部ジョブスケジューラを利用して、定期処理（データ取得、予約投稿チェック）を実行
- **ロギング:**
  - Netlify Functions のログ機能や、外部ログ管理サービス (LogDNA、Sentry 等) を活用して各種エラー・イベントを記録
- **モニタリング:**
  - Supabase と Netlify のモニタリング機能を利用し、システム稼働状況を監視。異常時は Slack、Email 等の外部通知を実施

### 4.4 デプロイメント・CI/CD

- **CI/CDパイプライン:**
  - GitHub Actions などを利用し、Netlify への自動デプロイメントパイプラインを構築
- **テスト:**
  - ユニットテスト、統合テスト、負荷テスト、セキュリティテストをステージング環境で実施

---

## 5. 運用・ローンチ前の必要項目

- **ドキュメント:**
  - API 仕様書、ユーザーマニュアル、運用マニュアルの作成
- **サポート体制:**
  - バグ報告や問い合わせ対応のための運用フローの策定
- **バックアップ・リカバリ:**
  - Supabase の定期バックアップおよびリカバリ手順の整備
- **セキュリティテスト:**
  - 脆弱性診断および必要なセキュリティ対策の最終確認

---

## 6. 全体の連携イメージ

### 6.1 台本作成機能連携

- **ユーザー操作:**  
  ユーザーが台本生成画面でタイトルを入力
- **バックエンド:**  
  タイトル受信 → 固定または DB からプロンプトテンプレート取得 → プロンプト組み立て → ChatGPT API 呼び出し → 生成結果を整形して返却
- **フロントエンド:**  
  生成結果がテキストエリアに表示され、ユーザーが編集可能

---

### 6.2 投稿予約機能連携

- **ユーザー操作:**  
  ユーザーが予約カレンダー画面で投稿予約情報（予約日時、投稿内容、対象SNSなど）を入力して送信
- **バックエンド:**  
  予約情報を Supabase の「post_reservations」テーブルに保存 → 定期ジョブで予約情報をチェック → 予約時刻に合わせSNS APIへ投稿リクエスト実施 → 結果を DB に記録し、エラー時は通知
- **フロントエンド:**  
  予約情報および投稿状況がカレンダー UI に反映され、ユーザーは予約の編集・確認が可能

---

### 6.3 分析ダッシュボード・レポート出力連携

- **ユーザー操作:**  
  ユーザーがダッシュボード画面で、開始日・終了日、SNS、表示指標を選択し、集計結果を折れ線グラフ、棒グラフ、及び Excel ライクなテーブル形式で確認。  
  レポート出力機能から、希望するファイル形式（Excel、CSV、PDF）を選択してレポートをダウンロード
- **バックエンド:**  
  Supabase から各SNSデータを取得し、集計処理を実施 → 集計結果を JSON およびテーブルデータに整形して返却 → 出力リクエスト時に指定条件でレポートファイルを生成し、ダウンロードリンクを返却
- **フロントエンド:**  
  集計結果とレポートダウンロードリンクが表示される

---

### 6.4 競合分析機能連携

- **ユーザー操作:**
  - ユーザーが競合分析画面で、分析対象期間（開始日・終了日）を指定
  - 指定期間内の競合アカウントの投稿、エンゲージメント等のデータが一覧表示され、投稿タイプやエンゲージメント数でのフィルタ・ソートが可能
- **バックエンド:**
  - Supabase 内の SNS データから指定期間内の競合データを抽出し、必要な統計情報に集計
  - 集計結果を JSON 形式でフロントエンドに返却し、一覧表示やフィルタ機能を提供
- **フロントエンド:**
  - 取得した競合分析用データを Excel ライクなテーブル形式で表示し、ユーザーがフィルタ・ソートを実施可能

---

## 7. まとめ

本要件定義書は、Netlify および Bolt.new を利用して AWS 非依存で実装する場合の SNSマーケティング支援ツールの全体構成を詳細に定義しています。  
ユーザー認証、SNS API 連携、台本生成、投稿予約、分析ダッシュボード・レポート出力、競合分析、そして管理者用のユーザー・プロンプト管理機能を含む全機能の実装フロー、データベース設計、連携方法、エラーハンドリング、セキュリティ対策、ならびに運用・デプロイメント体制について明確に記載しています。  
各機能の詳細仕様や実装方法に関しては、担当者間でディスカッションを重ね、最終仕様を確定してください。

---
